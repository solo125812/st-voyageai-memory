<!-- VoyageAI RAG Memory Settings Panel -->
<div class="voyageai-memory-settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>ğŸ§  VoyageAI RAG Memory</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <!-- Enable/Disable Toggle -->
            <div class="voyageai-memory_block flex-container flexFlowColumn">
                <div class="flex-container alignItemsCenter">
                    <input id="voyageai_memory_enabled" type="checkbox" />
                    <label for="voyageai_memory_enabled"><strong>Enable Extension</strong></label>
                </div>
                <small class="voyageai-hint">Enable or disable the RAG memory system</small>
            </div>

            <hr class="sysHR" />

            <!-- Summarization API Settings -->
            <div class="voyageai-memory_block">
                <h4 class="voyageai-section-title">ğŸ“ Summarization API</h4>
                
                <div class="flex-container flexFlowColumn marginBot5">
                    <label for="voyageai_summarization_url">API URL</label>
                    <input id="voyageai_summarization_url" type="text" class="text_pole" 
                           placeholder="https://api.openai.com/v1" />
                    <small class="voyageai-hint">OpenAI-compatible API endpoint</small>
                </div>

                <div class="flex-container flexFlowColumn marginBot5">
                    <label for="voyageai_summarization_key">API Key</label>
                    <input id="voyageai_summarization_key" type="password" class="text_pole" 
                           placeholder="sk-..." />
                </div>

                <div class="flex-container flexFlowColumn marginBot5">
                    <label for="voyageai_summarization_model">Model</label>
                    <input id="voyageai_summarization_model" type="text" class="text_pole"
                           placeholder="gemini-2.0-flash-exp" />
                    <small class="voyageai-hint">Model name for summarization (ì˜ˆ: gemini-2.0-flash-exp, gpt-4o-mini)</small>
                </div>

                <div class="flex-container alignItemsCenter marginBot5">
                    <input id="voyageai_test_summarization" class="menu_button" type="button" 
                           value="ğŸ” Test Connection" />
                    <span id="voyageai_summarization_status" class="voyageai-status"></span>
                </div>
            </div>

            <hr class="sysHR" />

            <!-- VoyageAI Settings -->
            <div class="voyageai-memory_block">
                <h4 class="voyageai-section-title">ğŸš€ VoyageAI Embeddings</h4>

                <div class="flex-container flexFlowColumn marginBot5">
                    <label for="voyageai_api_key">VoyageAI API Key</label>
                    <input id="voyageai_api_key" type="password" class="text_pole" 
                           placeholder="pa-..." />
                </div>

                <div class="flex-container flexFlowColumn marginBot5">
                    <label for="voyageai_model">Embedding Model</label>
                    <select id="voyageai_model" class="text_pole">
                        <option value="voyage-4-large">Voyage 4 Large (1024 dims)</option>
                        <option value="voyage-3-large">Voyage 3 Large (1024 dims)</option>
                        <option value="voyage-3">Voyage 3 (1024 dims)</option>
                        <option value="voyage-3-lite">Voyage 3 Lite (512 dims)</option>
                        <option value="voyage-code-3">Voyage Code 3 (1024 dims)</option>
                    </select>
                </div>

                <div class="flex-container alignItemsCenter marginBot5">
                    <input id="voyageai_test_embedding" class="menu_button" type="button" 
                           value="ğŸ” Test Connection" />
                    <span id="voyageai_embedding_status" class="voyageai-status"></span>
                </div>
            </div>

            <hr class="sysHR" />

            <!-- Behavior Settings -->
            <div class="voyageai-memory_block">
                <h4 class="voyageai-section-title">âš™ï¸ Behavior</h4>

                <div class="flex-container alignItemsCenter marginBot5">
                    <input id="voyageai_auto_store" type="checkbox" />
                    <label for="voyageai_auto_store">Auto-store new messages</label>
                </div>
                <small class="voyageai-hint marginBot5">Automatically process and store new messages</small>

                <div class="flex-container alignItemsCenter marginBot5">
                    <input id="voyageai_auto_retrieve" type="checkbox" />
                    <label for="voyageai_auto_retrieve">Auto-retrieve memories</label>
                </div>
                <small class="voyageai-hint marginBot5">Automatically inject relevant memories into context</small>

                <div class="flex-container flexFlowColumn marginBot5">
                    <label for="voyageai_top_k">Top K Memories</label>
                    <input id="voyageai_top_k" type="number" class="text_pole" 
                           min="1" max="20" value="5" />
                    <small class="voyageai-hint">Number of memories to retrieve (1-20)</small>
                </div>

                <div class="flex-container flexFlowColumn marginBot5">
                    <label for="voyageai_similarity_threshold">Similarity Threshold</label>
                    <input id="voyageai_similarity_threshold" type="number" class="text_pole" 
                           min="0" max="1" step="0.05" value="0.7" />
                    <small class="voyageai-hint">Minimum similarity score (0.0 - 1.0)</small>
                </div>

                <div class="flex-container flexFlowColumn marginBot5">
                    <label for="voyageai_injection_position">Memory Injection Position</label>
                    <select id="voyageai_injection_position" class="text_pole">
                        <option value="afterScenario">After Scenario (ì‹œë‚˜ë¦¬ì˜¤ ë’¤)</option>
                        <option value="beforeScenario">Before Scenario (ì‹œë‚˜ë¦¬ì˜¤ ì•)</option>
                        <option value="inAuthorsNote">In Author's Note (ì‘ê°€ ë…¸íŠ¸ ë‚´)</option>
                        <option value="afterCharacter">After Character Description (ìºë¦­í„° ì„¤ëª… ë’¤)</option>
                        <option value="atDepth">At Depth (ê¹Šì´ ì§€ì •)</option>
                    </select>
                </div>

                <div class="flex-container flexFlowColumn marginBot5">
                    <label for="voyageai_injection_depth">Injection Depth / ì£¼ì… ê¹Šì´</label>
                    <input id="voyageai_injection_depth" type="number" class="text_pole"
                           min="0" max="100" value="0" />
                    <small class="voyageai-hint">ë©”ì‹œì§€ ê¹Šì´ Nì— ê¸°ì–µ ì£¼ì… (0=ìµœì‹  ë©”ì‹œì§€ ìœ„) / Inject memories at message depth N</small>
                </div>

                <hr class="sysHR" />

                <h5 class="marginBot5">ğŸ“‹ Message Summarization Filter / ë©”ì‹œì§€ ìš”ì•½ í•„í„°</h5>

                <div class="flex-container alignItemsCenter marginBot5">
                    <input id="voyageai_summarize_bot" type="checkbox" checked />
                    <label for="voyageai_summarize_bot">Summarize Bot Messages / ë´‡ ë©”ì‹œì§€ ìš”ì•½</label>
                </div>

                <div class="flex-container alignItemsCenter marginBot5">
                    <input id="voyageai_summarize_user" type="checkbox" checked />
                    <label for="voyageai_summarize_user">Summarize User Messages / ìœ ì € ë©”ì‹œì§€ ìš”ì•½</label>
                </div>
                <small class="voyageai-hint marginBot5">ì–´ë–¤ ë©”ì‹œì§€ë¥¼ ìš”ì•½í•˜ê³  ì €ì¥í• ì§€ ì„ íƒ / Select which messages to summarize and store</small>

                <hr class="sysHR" />

                <div class="flex-container flexFlowColumn marginBot5">
                    <label for="voyageai_language">Summary Language / ìš”ì•½ ì–¸ì–´</label>
                    <select id="voyageai_language" class="text_pole">
                        <option value="ko">í•œêµ­ì–´ (Korean)</option>
                        <option value="en">English</option>
                    </select>
                    <small class="voyageai-hint">ê¸°ì–µ ìš”ì•½ì— ì‚¬ìš©í•  ì–¸ì–´ / Language for memory summaries</small>
                </div>
            </div>

            <hr class="sysHR" />

            <!-- Actions -->
            <div class="voyageai-memory_block">
                <h4 class="voyageai-section-title">ğŸ”§ Actions</h4>
                
                <div class="flex-container marginBot5">
                    <input id="voyageai_store_current" class="menu_button" type="button" 
                           value="ğŸ“¥ Store Current Chat" title="Process and store all messages from current chat" />
                    <input id="voyageai_clear_memories" class="menu_button menu_button_danger" type="button" 
                           value="ğŸ—‘ï¸ Clear Memories" title="Clear all memories for current character" />
                </div>

                <div class="flex-container marginBot5">
                    <input id="voyageai_export_memories" class="menu_button" type="button" 
                           value="ğŸ“¤ Export" title="Export memories to JSON file" />
                    <input id="voyageai_import_memories" class="menu_button" type="button" 
                           value="ğŸ“¥ Import" title="Import memories from JSON file" />
                    <input type="file" id="voyageai_import_file" accept=".json" style="display: none;" />
                </div>

                <div class="flex-container marginBot5">
                    <input id="voyageai_view_memories" class="menu_button" type="button" 
                           value="ğŸ‘ï¸ View Memories" title="View stored memories for current character" />
                </div>
            </div>

            <hr class="sysHR" />

            <!-- Status Display -->
            <div class="voyageai-memory_block">
                <div class="voyageai-stats-container">
                    <div class="voyageai-stat">
                        <span class="voyageai-stat-label">Memories:</span>
                        <span id="voyageai_memory_count" class="voyageai-stat-value">0</span>
                    </div>
                    <div class="voyageai-stat">
                        <span class="voyageai-stat-label">Last Updated:</span>
                        <span id="voyageai_last_updated" class="voyageai-stat-value">Never</span>
                    </div>
                    <div class="voyageai-stat">
                        <span class="voyageai-stat-label">Status:</span>
                        <span id="voyageai_status" class="voyageai-stat-value voyageai-status-ready">Ready</span>
                    </div>
                </div>
            </div>

            <hr class="sysHR" />

            <!-- Advanced Settings (Collapsible) -->
            <div class="voyageai-memory_block">
                <div class="inline-drawer">
                    <div class="inline-drawer-toggle inline-drawer-header">
                        <span>Advanced Settings / ê³ ê¸‰ ì„¤ì •</span>
                        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
                    </div>
                    <div class="inline-drawer-content">
                        <div class="flex-container flexFlowColumn marginBot5">
                            <label for="voyageai_word_limit">Summary Word Limit / ìš”ì•½ ë‹¨ì–´ ì œí•œ</label>
                            <input id="voyageai_word_limit" type="number" class="text_pole"
                                   min="20" max="200" value="50" />
                            <small class="voyageai-hint">ìš”ì•½ì˜ ìµœëŒ€ ë‹¨ì–´ ìˆ˜ (20-200) / Maximum words per summary</small>
                        </div>

                        <div class="flex-container alignItemsCenter marginBot5">
                            <input id="voyageai_include_history" type="checkbox" />
                            <label for="voyageai_include_history">Include Summary History / ìš”ì•½ íˆìŠ¤í† ë¦¬ í¬í•¨</label>
                        </div>
                        <small class="voyageai-hint marginBot5">ì´ì „ ìš”ì•½ì„ ì»¨í…ìŠ¤íŠ¸ë¡œ í¬í•¨ / Include previous summaries as context</small>

                        <div class="flex-container flexFlowColumn marginBot5">
                            <label for="voyageai_history_count">Summary History Count / ìš”ì•½ íˆìŠ¤í† ë¦¬ ê°œìˆ˜</label>
                            <input id="voyageai_history_count" type="number" class="text_pole"
                                   min="1" max="10" value="3" />
                            <small class="voyageai-hint">ì»¨í…ìŠ¤íŠ¸ì— í¬í•¨í•  ì´ì „ ìš”ì•½ ìˆ˜ (1-10) / Number of previous summaries to include</small>
                        </div>

                        <hr class="sysHR" />

                        <h5 class="marginBot5">ğŸ“œ Raw Message History / ì›ë³¸ ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬</h5>

                        <div class="flex-container alignItemsCenter marginBot5">
                            <input id="voyageai_include_raw_history" type="checkbox" />
                            <label for="voyageai_include_raw_history">Include Raw Messages / ì›ë³¸ ë©”ì‹œì§€ í¬í•¨</label>
                        </div>
                        <small class="voyageai-hint marginBot5">ì´ì „ ì›ë³¸ ì±„íŒ… ë©”ì‹œì§€ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ í¬í•¨ / Include previous raw chat messages as context</small>

                        <div class="flex-container flexFlowColumn marginBot5">
                            <label for="voyageai_raw_history_count">Message Count / ë©”ì‹œì§€ ê°œìˆ˜</label>
                            <input id="voyageai_raw_history_count" type="number" class="text_pole"
                                   min="1" max="20" value="5" />
                            <small class="voyageai-hint">í¬í•¨í•  ì´ì „ ë©”ì‹œì§€ ìˆ˜ (1-20) / Number of previous messages to include</small>
                        </div>

                        <div class="flex-container alignItemsCenter marginBot5">
                            <input id="voyageai_raw_include_bot" type="checkbox" checked />
                            <label for="voyageai_raw_include_bot">Bot Messages / ë´‡ ë©”ì‹œì§€</label>
                        </div>

                        <div class="flex-container alignItemsCenter marginBot5">
                            <input id="voyageai_raw_include_user" type="checkbox" checked />
                            <label for="voyageai_raw_include_user">User Messages / ìœ ì € ë©”ì‹œì§€</label>
                        </div>
                        <small class="voyageai-hint marginBot5">íˆìŠ¤í† ë¦¬ì— í¬í•¨í•  ë©”ì‹œì§€ ìœ í˜• ì„ íƒ / Select which message types to include</small>

                        <hr class="sysHR" />

                        <div class="flex-container flexFlowColumn marginBot5">
                            <label for="voyageai_custom_prompt">Custom Summarization Prompt / ì»¤ìŠ¤í…€ ìš”ì•½ í”„ë¡¬í”„íŠ¸</label>
                            <textarea id="voyageai_custom_prompt" class="text_pole textarea_compact"
                                      rows="4" placeholder="ë¹„ì›Œë‘ë©´ ì„ íƒí•œ ì–¸ì–´ì˜ ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤..."></textarea>
                            <small class="voyageai-hint">ê¸°ì–µ ìš”ì•½ ë°©ì‹ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ / Customize how messages are summarized</small>
                        </div>

                        <div class="flex-container flexFlowColumn marginBot5">
                            <label for="voyageai_memory_template">Memory Injection Template / ê¸°ì–µ ì£¼ì… í…œí”Œë¦¿</label>
                            <textarea id="voyageai_memory_template" class="text_pole textarea_compact"
                                      rows="3" placeholder="[ê³¼ê±° ëŒ€í™”ì—ì„œ ê´€ë ¨ëœ ê¸°ì–µë“¤: {{memories}}]"></textarea>
                            <small class="voyageai-hint">{{memories}} í”Œë ˆì´ìŠ¤í™€ë” ì‚¬ìš© / Template for injecting memories</small>
                        </div>

                        <div class="flex-container alignItemsCenter marginBot5">
                            <input id="voyageai_debug_mode" type="checkbox" />
                            <label for="voyageai_debug_mode">Debug Mode / ë””ë²„ê·¸ ëª¨ë“œ</label>
                        </div>
                        <small class="voyageai-hint">ì½˜ì†”ì— ìƒì„¸ ë¡œê·¸ ì¶œë ¥ / Log detailed information to console</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Memory Viewer Modal -->
<div id="voyageai_memory_viewer" class="voyageai-modal" style="display: none;">
    <div class="voyageai-modal-content">
        <div class="voyageai-modal-header">
            <h3>ğŸ§  Stored Memories</h3>
            <span id="voyageai_close_viewer" class="voyageai-modal-close">&times;</span>
        </div>
        <div class="voyageai-modal-body">
            <div id="voyageai_memories_list" class="voyageai-memories-list">
                <!-- Memories will be dynamically inserted here -->
            </div>
        </div>
        <div class="voyageai-modal-footer">
            <input id="voyageai_close_viewer_btn" class="menu_button" type="button" value="Close" />
        </div>
    </div>
</div>